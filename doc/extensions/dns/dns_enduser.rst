=============================
Brief introduction to dnsinfo
=============================

.. contents:: Contents
.. section-numbering::


Introduction
=============

dnsinfo is a system for storing information about computers in a
network.  Some features include:

- building of bind compatible zone files with data such as

  - A records
  - CNAMEs
  - MX records
  - HINFO records
  - SRV records
  - automatic reverse map data = forward map with option to override
  - mx-sets makes it easier to maintain the diversity of MX records
  - etc.
- various checks to maintain data consistency
- hosts file creation
- associating comments/contact information with machines
- machine netgroups
- delegation of administrative-rights for subnets to a group of people

Dnsinfo is built as an extensiton module to Cerebrum.  While the current
implementation is only loosely tied to the cerebrum-core schema, a
tighter integration is expected in the future.


The full version of Dnsinfo
------------------------------

The term Dnsinfo has been used at UoO for some time.  It referes to a
non-existing software package that can be used to keep track of some
information about computers.  Exactly what Dnsinfo was supposed to do is
unclear; some versions were supposed to contain detailed information
about each computer, such as processor type, memory etc, while others
wanted administrative information like where the system was bought
etc.

The diversity of the information that one could want in an Dnsinfo-like
system could result in a fairly complex piece of software that would
take a long time to develop.

The Dnsinfo implementation described in this document only has a subset
of these features.


Limitations
---------------
Dnsinfo does not support all records that bind supports.  DNS records not
supported by Dnsinfo should be placed above the 'AUTOGENERATED' part of
the generated file.


The client
================

JBofh may be used to interact with dnsinfo.  All commands are placed in
the "host" group.  For instance, the command to allocate an IP for a new
host is "host add".


Available commands
--------------------

The following commands has been implemented::

  bofh> help host
     host       - Commands for administrating IP numbers
      a_add       host_name subnet_or_ip [force]          
                  - legg til en a-record
      a_remove    host_name [ip]                          
                  - fjern en a-record
      add         host_name_repeat subnet_or_ip hinfo comment contact [force]
                  - Registrerer ip-addresse for en ny maskin
      cname_add   alias_name existing_host [force]        
                  - registrer et cname
      comment     host_name comment                       
                  - Sette kommentar for en gitt maskin
      contact     host_name contact                       
                  - Oppgi contact for gitt maskin
      hinfo_list                                          
                  - list lovlige hinfo verdier
      hinfo_set   host_name hinfo                         
                  - sette hinfo
      info        host_id                                 
                  - Lister data for gitt hostnavn/ip-addresse eller cname
      mx_add      mx_set pri host_name                    
                  - legg ny entry til et MX set
      mx_remove   mx_set host_name                        
                  - fjern entry fra et MX set
      mx_set      host_name mx_set                        
                  - sette MX
      mx_show     [mx_set]                                
                  - Vid definisjonen av et MX set
      remove      host_id [force]                         
                  - Sletter data for oppgitt hosnavn/ip-nr
      rename      host_id host_id                         
                  - Forande et IP-nr/navn til et annet IP-nr/navn.
      srv_add     service_name pri weight port host_name  
                  - Opprette en SRV record
      srv_remove  service_name ttl pri weight port host_name
                  - Fjerne en SRV record
      ttl_set     host_name ttl                           
                  - Set TTL for en DNS-owner
      txt_set     host_name txt                           
                  - sette TXT
      unused_list subnet_or_ip                            
                  - list ledige ipnr
  bofh> help group
     group      - Group commands
      hadd           host_name gname [op]          
                     - add machine to a netgroup
      host           host_name                     
                     - list groups where host is a member
      hrem           host_name gname [op]          
                     - remove machine from a netgroup
    
When creating an ip-number and subnet_or_ip points to a subnet, the
first free IP-number in the subnet is used.  Dnsinfo will not
automatically use IP-numbers in reserved ranges, you have to type the
IP and use the 'force' option for this.


Arguments
~~~~~~~~~~~~~~~~~~~~

The various argument types are:

  host_name 
    The name of a host (does not have to be a FQDN i.e. ending with .com.)
  host_name_repeat
    The hostname may optionally be written as pc[001..150] to allocate
    150 ip-numbers in one go.  Any leading zeroes in the first
    argument is preserved.
  host_id
    host_name of ip-number
  hinfo
    The hinfo alias.  Use 'ip list_hinfo' for legal values.
  mailserver_id
    The name of the mx_set.  Use 'ip list_mx_sets' for legal values.
  comment
    Freetext field 
  contact 
    Freetext field.  Should some time in the future be connected to a
    Cerebrum entity-id
  subnet_or_ip
    A subnet or an IP-address.  129.240.x.y = IP.  129.240.x or
    129.240.x.y/ indicates a subnet.
  force
    Some operations require an "Y" to succeed if exsisting records has
    the same name etc.

Most query operations accept either a host_name or an ip_number for
lookup operations.  If a name is used where an IP is expected (like
"ip a_rem"), and the IP is not unique, and error message will be
shown.  (By the time you read this, a idtype:id syntax is probably
also supported)


Examples
-----------

(The hinfo_codes and mx_set names are result of automatic conversion,
and should be renamed manually)

Allocating an ip-number.  '?' may be used for help for each argument
like elsewhere in jbofh::

  bofh> host add 
  Enter host name(s) >?
  Multiple hostnames may be entered like pcusit[01..30]
  Enter host name(s) >gazonk
  Enter subnet or ip >?
  Enter subnet or ip for this operation.  129.240.x.y = IP.  129.240.x or 129.240.x.y/ indicates a subnet.
  Enter subnet or ip >129.240.200
  Enter HINFO code >?
  Legal values are: 
   - win      -> IBM-PC   WINDOWS
   - linux    -> IBM_PC   LINUX
   - printer  -> PRINTER  PRINTER
   - unix     -> UNIX     UNIX
   - nett     -> NET      NET
   - mac      -> MAC      DARWIN
   - other    -> OTHER    OTHER
  Enter HINFO code >linux
  Enter comment >?
  Typically location
  Enter comment >test maskin
  Enter contact >?
  Typically an e-mail address
  Enter contact >foo@bar.com
  name                           ip
  gazonk                         129.240.201.158

Several machines can be registered in one go::

  bofh> host add testpc[01..05] 129.240.130 linux "fine maskiner" "foo@bar.com"
  name                           ip
  testpc01                       129.240.130.21
  testpc02                       129.240.130.22
  testpc03                       129.240.130.23
  testpc04                       129.240.130.24
  testpc05                       129.240.130.25
  bofh> host add (finmaskin fineremaskin) 129.240.130 linux "fine maskiner" "foo@bar.com"
  name                           ip
  finmaskin                      129.240.130.26
  name                           ip
  fineremaskin                   129.240.130.28

Showing information about a machine::

  bofh> host info gazonk
  Name:                  gazonk.uio.no.
                         contact=foo@bar.com
                         comment=test maskin
  A-records              IP
    gazonk.uio.no.       129.240.201.158
  Hinfo:                 os=IBM_PC cpu=LINUX
  MX-set:                mx_target_1

Adding an a-record with explicit IP on an unknown subnet::

  bofh> host a_add barbar 127.0.0.1
  Error: CerebrumError: Unknown subnet.  Must force
  bofh> host a_add barbar 127.0.0.1 y
  OK, ip=127.0.0.1

Displaying a mx-target::

  bofh> host mx_show  mx_target_1
  MX-set               TTL          Priority   Target
  mx_target_1          <not set>    10         smtp.uio.no.

Renaming a machine, either by name or IP::

  bofh> host rename smtp lesemail
  OK, dns-owner smtp renamed to lesemail
  bofh> host rename morgoth 129.240.201.239
  OK, ip-number morgoth renamed to 129.240.201.239

Note that all references to smtp has been updated (because the change
was done directly in the dns-owner table)::

  bofh> host mx_show  mx_target_1
  MX-set               TTL          Priority   Target
  mx_target_1          <not set>    10         lesemail.uio.no.
  
Adding a cname::

  bofh> host cname_add barfoo gazonk
  OK, cname registered for gazonk

Deleting a host::

  bofh> host remove gazonk
  Error: DNSError: A-record is used as target, or has a host_info entry
  bofh> host cname_remove barfoo
  OK, cname barfoo completly removed
  bofh> host remove gazonk
  OK, DNS-owner gazonk completly removed

Somethimes the deletion must be forced::

  bofh> host info harell-gw
  Name:                  harell-gw.uio.no.
                         contact=<not set>
                         comment=Helge Falkenberg-Arell
  A-records              IP
    harell-gw.uio.no.    129.240.209.241
    harell-gw.uio.no.    129.240.230.103
  Hinfo:                 os=CISCO cpu=IOS
  MX-set:                mx_target_1
  bofh> host remove harell-gw
  Error: CerebrumError: Multiple records would be deleted, must force
  bofh> host remove harell-gw Y
  OK, DNS-owner harell-gw completly removed


TODO
==========

Utestående ting

Ting som må fikses før Versjon 1
-----------------------------------

- ?

Ting som kan vente til Version >= 1.1:
----------------------------------------

- Dnsinfo bør ha foreign-keys mot Cerebrum entiteter for bla. contact-info.

- rettighetshåndtering (innsnevring av rettigheter)

..
   arch-tag: a59f6b45-345a-4891-8226-fbccc208adc0
