[ This documentation is in Norwegian as the system in question is only
  used in Norway ]

Dette dokumentet beskriver hvordan data skal importeres fra FS til
Cerebrum, men ikke ned til minste detalj.  Jeg regner med at noen
kommer til å skrive det om en gang i tiden, med mindre det blir
oppgitt til fordel for "the spec is the source"; hvis så skjer bør vel
dokumentet slettes.

1.0 Import av personinformasjon fra FS til Cerebrum.
====================================================

Scriptet import_FS.py skal importere data om personer fra FS.  Det
importeres informasjon om for alle fagpersoner
(GetKursFagpersonundsemester), studenter (GetStudinfRegkort,
GetStudinfNaaKlasse, GetStudinfStudierett) og EVU-studenter
(GetStudinfEvuKurs).

For alle importerer vi:
  - fornavn
  - etternavn
  - fødselsnummer
  - kjønn
Fagpersoner:
  - arbeidsadresse fra fs.fagperson	(som co.address_post)
    Hvis denne ikke finnes, brukes hjemstedsadresse fra FS.person
  - alle stedkoder	(fs.fagpersonundsemester)
Studenter:
  - semesteradresse, fra FS.student	(som co.address_post)
    Hvis denne ikke finnes, brukes hjemstedsadresse fra FS.person
  - Følgende settes av scriptet som leser topics i 2.0:
    - Stedkode(r) (*_studieansv) for aktivt studieprogram
    - Stedkode(r) (*_kontroll) for emner eksamensmeldt eller
      undervisningsmeldt.

EVU-studenter:
  - Job-adresse, fra FS.deltaker	(som co.address_post)
    Hvis denne ikke finnes, brukes hjemstedsadresse fra FS.deltaker
    Hvis denne ikke finnes, brukes hjemstedsadresse fra FS.person
  - Stedkode(r) (*_Adm_ansvar) for kurs.


Når skal de med i importen:

 - Fagpersoner:
   - Hvis de har en postering for inneværende semester i fs.fagpersonundsemester

 - Student:
   - Hvis de har en 'lovlig' (dvs. <> 'PRIVATIST') studierett til et studieprogram.

   Merk: Disse blir aktive/ekte når de får et aktivt studieprogram
         (dvs. et studieprogram med studierett (dvs. <> 'PRIVATIST'),
         semesterregistrert (Regform: 'MANUELL' eller 'STUDWEB'), og
         meldt til eksamen i et emne som kan inngå i studieprogramet).
         Inntil dette er de kun 'passive' studenter.

 - EVU-studenter
   - Meldt til et kurs som har startdato senest om 14 dager, eller som
     avsluttes tidligst for 14 dager siden



2.0 Regler for automatisk bygging av kontoer o.l.
=================================================

Vi bygger konto til alle studenter med eksamensmelding i et aktivt
studieprogram (GetAlleEksamener), med mindre personen allerede har en
konto med _PersonAffiliationCode('STUDENT') (må denne affiliation være
valid?).

For alle med student-konto gjelder følgende:

- Personen får affiliation('STUDENT') mot stedkodene til alle dens
  studieprogram
- For EVU-studenter hentes stedkodene fra fs.etterutdkurs.*_Adm_ansvar
- Kontoen meldes inn i alle primær-/grupper angitt i studconfig.xml.
  Den meldes også ut av alle øvrige grupper listet som "auto-grupper".
- Kontoen gis alle spread som matcher i studconfig.xml
- Kontoen gis et hjemmeområde, primær e-postadresse og primærgruppe
  (se under)


2.1 Order-of-precedence for attributter man bare kan ha ett av
--------------------------------------------------------------

En konto kan bare ha ett hjemmeområde, primær e-postadresse og
primærgruppe.  Når studconfig.xml forteller at brukeren har multiple
verdier for disse gjelder følgende regler:

- Studienivåkode [100-300> leses som 100 og [300-400> leses som 300.
  Hvis verdien(e) for det høyeste nivået er unik, velges denne.

(reglene under gjelder bare for emner/studieprogram på høyeste nivå)

- Hvis den ene verdien er satt fra et emne, og den andre fra et
  studieprogram, velges verdien for emne.
- Home settes til /uio/platon/div-{h|l}\d+
- Primærgruppe og primær e-postadresse settes til det av alternativene
  som kommer først alfabetisk.


2.2 Reservering av brukernavn
-----------------------------

Alle personer med opptak til et studieprogram (FinnAlleStudprogSko)
får et brukernavn og passord, men de får ikke noen PosixUser eller
spread.


2.3 Tilordning av skriverkvoter
-------------------------------

TODO: Her må det skrives noe.  Det er fint om studconfig.xml bestemmer
hvem som skal ha kvoter.


2.4 Utsending av papirbrev
--------------------------

Det sendes brev for alle automatisk byggede brukere.  Brevet sendes
til semesteradressen hvis denne finnes.  Hvis ikke, sendes det til
hjemstedsadressen.  Brev sendes ikke ut av landet.  Alle brev er på
norsk.


2.5 Tidspunkt for automatiske handlinger
----------------------------------------

- Skriverkvoter oppdateres natt til fredag
- Innmelding i grupper skjer hver natt
- Endring av primærgruppe skjer en gang i semesteret (dato?)
- Primær e-postadresse settes hver onsdag
- Brukere bygges hver natt
- Brukere flyttes hver natt forutsatt at det er > 7 dager siden
  forrige flytting
- Brukere meldes ut av grupper: når da?

2.5.1 Sperring:
---------------
1. Studentbrukere til studenter som ikke er semesterregistrert innen 20.
   februar eller 20. september sperres (en gang i semesteret, eller i
   forbindelse med jobben som skal utføre sperring i punkt. 2).
2. Studentbrukere til studenter som ikke har eksamensmelding i minst ett
   emne sperres (hver natt etter 20. februar/20. september)
3. Studentbrukere til studenter som kun er eksamensmeldt til emner som ikke
   kan inngå i minst et av de studieprogrammene studenten har opptak til
   sperres etter 15. mars/15. oktober ("privatister", her venter vi på at
   fakultetene skal gjennomføre overgangsopptak)

2.5.2 Sletting:
---------------
1. Studentbrukere til studenter som har vært inaktive forrige semester
   slettes 20. februar/20. september (en gang i semesteret).
2. Etter 15. mars/15. oktober slettes alle brukere som har vært sperret i
   tre måneder (90 dager :))
3. EVU-studenter slettes ca. to uker etter at kurset er gjennomført
